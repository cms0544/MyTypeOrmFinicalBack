(()=>{var e={283:(e,t,r)=>{var n=r(464),o=r(84);function i(){return(new Date).getTime()}for(var s=Array.prototype.slice,u={},c=void 0!==r.g&&r.g.console?r.g.console:"undefined"!=typeof window&&window.console?window.console:{},a=[[function(){},"log"],[function(){c.log.apply(c,arguments)},"info"],[function(){c.log.apply(c,arguments)},"warn"],[function(){c.warn.apply(c,arguments)},"error"],[function(e){u[e]=i()},"time"],[function(e){var t=u[e];if(!t)throw new Error("No such label: "+e);delete u[e],t=i()-t,c.log(e+": "+t+"ms")},"timeEnd"],[function(){var e=new Error;e.name="Trace",e.message=n.format.apply(null,arguments),c.error(e.stack)},"trace"],[function(e){c.log(n.inspect(e)+"\n")},"dir"],[function(e){var t;e||(t=s.call(arguments,1),o.ok(!1,n.format.apply(null,t)))},"assert"]],l=0;l<a.length;l++){var p=(d=a[l])[0],d=d[1];c[d]||(c[d]=p)}e.exports=c},356:function(e,t,r){"use strict";var n=r(283),o=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.CostController=void 0,r(527)),u=r(760),c=r(754),a=r(819);function l(){this.costRepository=s.AppDataSource.getRepository(u.TbCost),this.userRepository=s.AppDataSource.getRepository(c.TbUser),this.currentPriceRepository=s.AppDataSource.getRepository(a.TbCurrentprice)}l.prototype.all=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,n,o,s,u,c,a,l;return i(this,(function(i){switch(i.label){case 0:return u=e.query,t=u.pricefrom,r=u.priceto,n=u.datefrom,o=u.dateto,s=u.key,u=u.costtype,c="1=1",a=e.id,l={pricefrom:t,priceto:r,datefrom:n,dateto:o,key:"%"+s+"%",costtype:u,userid:a},""!=t&&null!=t&&(c+=" and cost.price >= :pricefrom"),""!=r&&null!=r&&(c+=" and cost.price <= :priceto"),null!=n&&""!=n&&(c+=" and cost.date >= :datefrom"),null!=o&&""!=o&&(c+=" and cost.date <= :dateto"),null!=s&&""!=s&&(c+=" and cost.descript like :key"),null!=u&&""!=u&&"-1"!=u&&(c+=" and cost.costtype = :costtype"),null!=a&&""!=a&&(c+=" and cost.userid = :userid"),[4,this.costRepository.createQueryBuilder("cost").select(["cost.id as id","cost.descript as descript","cost.price as price","cost.costtype as costtype"]).addSelect("DATE_FORMAT(cost.date,'%Y-%m-%d')","date").where(c,l).orderBy("date","DESC").getRawMany()];case 1:return[2,{success:1,res:i.sent()}]}}))}))},l.prototype.insertCost=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,o,s,c,a,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),c=e.body,t=c.descript,r=c.price,o=c.costtype,s=c.id,c=c.date,[4,this.userRepository.findOneBy({id:e.id})];case 1:return a=i.sent(),[4,this.costRepository.findOneBy({id:s})];case 2:return null!=(l=i.sent())&&null!=s?(l.descript=t,l.price=r,l.costtype=o,l.date=c):l=Object.assign(new u.TbCost,{descript:t,price:r,costtype:o,date:c}),null==a.tbCosts?a.tbCosts=[l]:a.tbCosts.push(l),l.user=a,[4,this.costRepository.save(l)];case 3:return i.sent(),[2,{success:1}];case 4:return l=i.sent(),n.log(l),[2,{success:0,message:l}];case 5:return[2]}}))}))},l.prototype.remove=function(e,t,r){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return t=parseInt(e.params.id),[4,this.costRepository.findOneBy({id:t})];case 1:return(t=r.sent())?[4,this.costRepository.remove(t)]:[2,{success:0,message:"this user not exist"}];case 2:return r.sent(),[2,{success:1}]}}))}))},l.prototype.getSum=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,n,o,s,u,c,a;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),s=e.query,a=s.pricefrom,t=s.priceto,r=s.datefrom,n=s.dateto,o=s.key,s=s.costtype,u="1=1",c={pricefrom:a,priceto:t,datefrom:r,dateto:n,key:"%"+o+"%",costtype:s,userid:e.id},""!=a&&null!=a&&(u+=" and cost.price >= :pricefrom"),""!=t&&null!=t&&(u+=" and cost.price <= :priceto"),null!=r&&""!=r&&(u+=" and cost.date >= :datefrom"),null!=n&&""!=n&&(u+=" and cost.date <= :dateto"),null!=o&&""!=o&&(u+=" and cost.descript like :key"),null!=s&&""!=s&&"-1"!=s&&(u+=" and cost.costtype = :costtype"),null!=e.id&&""!=e.id&&(u+=" and cost.userid = :userid"),[4,this.costRepository.createQueryBuilder("cost").select("sum(if(costtype = 1,-price,price))","sum").where(u,c).getRawOne()];case 1:return null==(a=i.sent().sum)&&(a=0),[2,{success:1,sum:parseFloat(a)}];case 2:return[2,{success:0,message:i.sent()}];case 3:return[2]}}))}))},l.prototype.getSumByMonth=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,n,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r=e.query,t=r.datefrom,r=r.dateto,n={userid:e.id,datefrom:t,dateto:r},o=" cost.userid = :userid ",null!=t&&(o+=" and cost.date >=:datefrom "),null!=r&&(o+=" and cost.date <=:dateto "),[4,this.costRepository.createQueryBuilder("cost").select("sum(if(costtype=1,-price,price))","y").addSelect("DATE_FORMAT(cost.date,'%Y-%m')","name").where(o,n).groupBy("DATE_FORMAT(cost.date,'%Y-%m')").getRawMany()];case 1:return[2,{success:1,res:i.sent()}];case 2:return[2,{success:0,message:i.sent()}];case 3:return[2]}}))}))},t.CostController=l},938:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.CurrentPriceController=void 0,r(527)),s=r(819),u=r(754);function c(){this.currentPriceRepository=i.AppDataSource.getRepository(s.TbCurrentprice),this.userRepository=i.AppDataSource.getRepository(u.TbUser)}c.prototype.insertCurrentPrice=function(e,t,r){return n(this,void 0,void 0,(function(){var t,r,n,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),r=e.body,t=r.currentprice,r=r.insertdate,[4,this.userRepository.findOneBy({id:e.id})];case 1:return n=o.sent(),(i=new s.TbCurrentprice).currentPrice=t,i.insertdate=r,null==n?[2,{success:0,message:"user is null"}]:(null==n.tbCurrentprices?n.tbCurrentprices=[i]:n.tbCurrentprices.push(i),i.user=n,[4,this.currentPriceRepository.save(i)]);case 2:return o.sent(),[2,{success:1}];case 3:return[2,{success:0,message:o.sent()}];case 4:return[2]}}))}))},c.prototype.getTopOneCurrentPrice=function(e,t,r){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.currentPriceRepository.createQueryBuilder("currentprice").select("currentprice.currentPrice","currentprice").addSelect("DATE_FORMAT(currentprice.insertdate,'%Y-%m-%d')","insertdate").where("userid=:userid",{userid:e.id}).orderBy("id","DESC").getRawOne()];case 1:return[2,{success:1,res:t.sent()}];case 2:return[2,{success:0,message:t.sent()}];case 3:return[2]}}))}))},t.CurrentPriceController=c},225:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.PathController=void 0,r(527)),s=r(59),u=r(250);function c(){this.tbpathRepository=i.AppDataSource.getRepository(s.TbPath)}c.prototype.queryAll=function(e,t,r){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=e.body.querytext,[4,this.tbpathRepository.find({where:[{name:(0,u.Like)("%"+t+"%")},{title:(0,u.Like)("%"+t+"%")}]})];case 1:return[2,{success:1,data:r.sent()}];case 2:return[2,{success:0,message:r.sent()}];case 3:return[2]}}))}))},c.prototype.add=function(e,t,r){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=new s.TbPath,[4,this.tbpathRepository.merge(t,e.body)];case 1:return r.sent(),this.tbpathRepository.save(t),[2,{success:1,mesg:"success"}];case 2:return[2,{success:0,msg:r.sent()}];case 3:return[2]}}))}))},c.prototype.delete=function(e,t,r){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.tbpathRepository.find({where:{id:(0,u.In)(e.body.ids)}})];case 1:return t=r.sent(),this.tbpathRepository.remove(t),[2,{success:1,msg:""}];case 2:return[2,{success:0,msg:r.sent()}];case 3:return[2]}}))}))},t.PathController=c},758:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.RoleController=void 0,r(527)),s=r(737);function u(){this.roleRepository=i.AppDataSource.getRepository(s.TbRole)}u.prototype.getRole=function(e,t,r){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.roleRepository.find()];case 1:return[2,{success:1,data:e.sent()}]}}))}))},t.RoleController=u},592:function(e,t,r){"use strict";var n=r(283),o=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.UploadController=void 0,r(738)),u=r(231),c=r(423),a=(r=s.diskStorage({destination:function(e,t,r){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,u.existsSync("img")];case 1:return e.sent()?[3,3]:[4,u.mkdirSync("img")];case 2:e.sent(),e.label=3;case 3:return r(null,"img"),[2]}}))}))},filename:function(e,t,r){r(null,c.parse(t.originalname).name+Date.now()+c.extname(t.originalname))}}),s({storage:r,fileFilter:function(e,t,r){"image/png"==t.mimetype||"image/jpg"==t.mimetype||"image/jpeg"==t.mimetype?r(null,!0):r(null,!1)}}));function l(){}l.prototype.upload=function(e,t,r){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.uploadfile(e,t)];case 1:return[2,{code:200,url:r.sent()}]}}))}))},l.prototype.uploadfile=function(e,t){var r="/img/";return new Promise((function(o,i){a.single("file")(e,t,(function(t){null!=t?i(t):(r+=e.file.filename,n.log(r),o(r))}))}))},t.UploadController=l},68:function(e,t,r){"use strict";var n=r(283),o=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.UserController=void 0,r(527)),u=r(754),c=r(655),a=r(397),l=r(809),p=r(344),d=r(432);function f(){this.userRepository=s.AppDataSource.getRepository(u.TbUser),this.userRoleRepository=s.AppDataSource.getRepository(c.TbUserRole),this.tbRoleRouteRepository=s.AppDataSource.getRepository(a.TbRoleRoute)}f.prototype.all=function(e,t,r){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.userRepository.find()]}))}))},f.prototype.login=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(o){switch(o.label){case 0:return t=e.body,r=t.username,t=t.password,[4,this.userRepository.findOne({where:{username:r}})];case 1:return null==(r=o.sent())?[2,{success:0,message:"用户名不正确"}]:d.compareSync(t,r.password)?(n=p.sign({id:r.id},"token",{expiresIn:"30d"}),[2,{success:1,user:r,token:n}]):[2,{success:0,message:"密码不正确"}]}}))}))},f.prototype.register=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,n,o,s;return i(this,(function(i){switch(i.label){case 0:return o=e.body,t=o.username,o.password,r=o.sex,n=o.photourl,o=o.city,[4,this.userRepository.findOne({where:{username:t}})];case 1:return null!=i.sent()?[2,{success:0,msg:"修改失败,"+t+"已存在"}]:(s=d.hashSync(e.body.password,10),s=Object.assign(new u.TbUser,{username:t,password:s,sex:r,photourl:n,city:o}),this.userRepository.save(s),[2,{success:1,user:s}])}}))}))},f.prototype.getinfo=function(e,t,r){return o(this,void 0,void 0,(function(){var t,r,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),parseInt(e.params.id),n.log(e.id),[4,this.userRoleRepository.createQueryBuilder("tb_user_role").leftJoinAndSelect("tb_user_role.role","tb_role").select("tb_role.name","name").where("tb_user_role.userid=:userid",{userid:e.id}).orderBy("tb_role.id","ASC").getRawMany()];case 1:return t=i.sent(),t=(0,l.convertJsonArrToArr)(t),[4,this.userRoleRepository.createQueryBuilder("tb_user_role").where("tb_user_role.userid=:userid",{userid:e.id}).select("tb_user_role.roleid","roleid")];case 2:return r=i.sent(),[4,this.tbRoleRouteRepository.createQueryBuilder("tb_role_route").leftJoinAndSelect("tb_role_route.path","tb_path").select("tb_path.*").where("tb_role_route.roleid in ("+r.getQuery()+")").setParameters(r.getParameters()).getRawMany()];case 3:return r=i.sent(),[2,{success:1,res:{roles:t,routes:r}}];case 4:return o=i.sent(),n.log(o),[2,{success:0,err:o}];case 5:return[2]}}))}))},f.prototype.logout=function(e,t,r){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,{success:1}]}))}))},f.prototype.remove=function(e,t,r){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return t=parseInt(e.params.id),[4,this.userRepository.findOneBy({id:t})];case 1:return(t=r.sent())?[4,this.userRepository.remove(t)]:[2,{success:0,message:"this user not exist"}];case 2:return r.sent(),[2,{success:1}]}}))}))},t.UserController=f},527:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppDataSource=void 0,r(142).config({path:".env.".concat("production")}),r(236);var n=r(250),o=r(754),i=r(760),s=r(819),u=r(59),c=r(737),a=r(397),l=r(319);r=r(655);t.AppDataSource=new n.DataSource({type:"mysql",host:"localhost",port:parseInt("3306"),username:"root",password:"admincmms",database:"mycost",synchronize:!1,logging:!1,entities:[o.TbUser,i.TbCost,s.TbCurrentprice,u.TbPath,c.TbRole,a.TbRoleRoute,l.TbCityinfo,r.TbUserRole],migrations:[],subscribers:[]})},319:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbCityinfo=void 0,r(250)),s=r(754);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],u.prototype,"id",void 0),n([(0,i.Column)("varchar",{name:"name",nullable:!0,length:255}),o("design:type",String)],u.prototype,"name",void 0),n([(0,i.Column)("int",{name:"fatherid",nullable:!0}),o("design:type",Number)],u.prototype,"fatherid",void 0),n([(0,i.Column)("varchar",{name:"level",nullable:!0,comment:"1-国家 2-省份 3-城市 4-区",length:255}),o("design:type",String)],u.prototype,"level",void 0),n([(0,i.OneToMany)((function(){return s.TbUser}),(function(e){return e.city2})),o("design:type",Array)],u.prototype,"tbUsers",void 0),n([(0,i.OneToMany)((function(){return s.TbUser}),(function(e){return e.country})),o("design:type",Array)],u.prototype,"tbUsers2",void 0),n([(0,i.OneToMany)((function(){return s.TbUser}),(function(e){return e.province})),o("design:type",Array)],u.prototype,"tbUsers3",void 0),r=n([(0,i.Entity)("tb_cityinfo",{schema:"mycost"})],u);function u(){}t.TbCityinfo=r},760:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbCost=void 0,r(250)),s=r(754);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],u.prototype,"id",void 0),n([(0,i.Column)("varchar",{name:"descript",length:255}),o("design:type",String)],u.prototype,"descript",void 0),n([(0,i.Column)("double",{name:"price",precision:22}),o("design:type",Number)],u.prototype,"price",void 0),n([(0,i.Column)("datetime",{name:"date",default:function(){return"CURRENT_TIMESTAMP"}}),o("design:type",Date)],u.prototype,"date",void 0),n([(0,i.Column)("int",{name:"costtype"}),o("design:type",Number)],u.prototype,"costtype",void 0),n([(0,i.Column)("int",{name:"userId",nullable:!0}),o("design:type",Number)],u.prototype,"userId",void 0),n([(0,i.ManyToOne)((function(){return s.TbUser}),(function(e){return e.tbCosts}),{onDelete:"RESTRICT",onUpdate:"RESTRICT"}),(0,i.JoinColumn)([{name:"userId",referencedColumnName:"id"}]),o("design:type",s.TbUser)],u.prototype,"user",void 0),r=n([(0,i.Index)("FK_80adec0c55169f3b43bb8b840b6",["userId"],{}),(0,i.Entity)("tb_cost",{schema:"mycost"})],u);function u(){}t.TbCost=r},819:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbCurrentprice=void 0,r(250)),s=r(754);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],u.prototype,"id",void 0),n([(0,i.Column)("decimal",{name:"currentPrice",nullable:!0,precision:10,scale:2}),o("design:type",String)],u.prototype,"currentPrice",void 0),n([(0,i.Column)("datetime",{name:"insertdate",nullable:!0,default:function(){return"CURRENT_TIMESTAMP"}}),o("design:type",Date)],u.prototype,"insertdate",void 0),n([(0,i.Column)("int",{name:"userid",nullable:!0}),o("design:type",Number)],u.prototype,"userid",void 0),n([(0,i.ManyToOne)((function(){return s.TbUser}),(function(e){return e.tbCurrentprices}),{onDelete:"RESTRICT",onUpdate:"RESTRICT"}),(0,i.JoinColumn)([{name:"userid",referencedColumnName:"id"}]),o("design:type",s.TbUser)],u.prototype,"user",void 0),r=n([(0,i.Index)("fk_userid",["userid"],{}),(0,i.Entity)("tb_currentprice",{schema:"mycost"})],u);function u(){}t.TbCurrentprice=r},59:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbPath=void 0,r(250)),s=r(397);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],u.prototype,"id",void 0),n([(0,i.Column)("varchar",{name:"path",nullable:!0,length:255}),o("design:type",String)],u.prototype,"path",void 0),n([(0,i.Column)("varchar",{name:"name",nullable:!0,length:255}),o("design:type",String)],u.prototype,"name",void 0),n([(0,i.Column)("varchar",{name:"title",nullable:!0,length:255}),o("design:type",String)],u.prototype,"title",void 0),n([(0,i.Column)("varchar",{name:"icon",nullable:!0,length:255}),o("design:type",String)],u.prototype,"icon",void 0),n([(0,i.Column)("int",{name:"fatherid"}),o("design:type",Number)],u.prototype,"fatherid",void 0),n([(0,i.Column)("varchar",{name:"componenturl",nullable:!0,length:255}),o("design:type",String)],u.prototype,"componenturl",void 0),n([(0,i.Column)("tinyint",{name:"noCache",nullable:!0,width:1}),o("design:type",Boolean)],u.prototype,"noCache",void 0),n([(0,i.OneToMany)((function(){return s.TbRoleRoute}),(function(e){return e.path})),o("design:type",Array)],u.prototype,"tbRoleRoutes",void 0),r=n([(0,i.Entity)("tb_path",{schema:"mycost"})],u);function u(){}t.TbPath=r},737:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbRole=void 0,r(250)),s=r(397),u=r(655);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],c.prototype,"id",void 0),n([(0,i.Column)("varchar",{name:"key",nullable:!0,unique:!0,length:255}),o("design:type",String)],c.prototype,"key",void 0),n([(0,i.Column)("varchar",{name:"name",nullable:!0,length:255}),o("design:type",String)],c.prototype,"name",void 0),n([(0,i.Column)("varchar",{name:"description",nullable:!0,length:255}),o("design:type",String)],c.prototype,"description",void 0),n([(0,i.OneToMany)((function(){return s.TbRoleRoute}),(function(e){return e.role})),o("design:type",Array)],c.prototype,"tbRoleRoutes",void 0),n([(0,i.OneToMany)((function(){return u.TbUserRole}),(function(e){return e.role})),o("design:type",Array)],c.prototype,"tbUserRoles",void 0),r=n([(0,i.Index)("uni_role",["key"],{unique:!0}),(0,i.Entity)("tb_role",{schema:"mycost"})],c);function c(){}t.TbRole=r},397:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbRoleRoute=void 0,r(250)),s=r(59),u=r(737);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],c.prototype,"id",void 0),n([(0,i.Column)("int",{name:"roleid",nullable:!0}),o("design:type",Number)],c.prototype,"roleid",void 0),n([(0,i.Column)("int",{name:"pathid",nullable:!0}),o("design:type",Number)],c.prototype,"pathid",void 0),n([(0,i.ManyToOne)((function(){return s.TbPath}),(function(e){return e.tbRoleRoutes}),{onDelete:"NO ACTION",onUpdate:"NO ACTION"}),(0,i.JoinColumn)([{name:"pathid",referencedColumnName:"id"}]),o("design:type",s.TbPath)],c.prototype,"path",void 0),n([(0,i.ManyToOne)((function(){return u.TbRole}),(function(e){return e.tbRoleRoutes}),{onDelete:"NO ACTION",onUpdate:"NO ACTION"}),(0,i.JoinColumn)([{name:"roleid",referencedColumnName:"id"}]),o("design:type",u.TbRole)],c.prototype,"role",void 0),r=n([(0,i.Index)("fk_role_pathid",["pathid"],{}),(0,i.Index)("fk_role_roleid",["roleid"],{}),(0,i.Entity)("tb_role_route",{schema:"mycost"})],c);function c(){}t.TbRoleRoute=r},754:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbUser=void 0,r(250)),s=r(760),u=r(819),c=r(319),a=r(655);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],l.prototype,"id",void 0),n([(0,i.Column)("varchar",{name:"username",length:255}),o("design:type",String)],l.prototype,"username",void 0),n([(0,i.Column)("varchar",{name:"password",length:255}),o("design:type",String)],l.prototype,"password",void 0),n([(0,i.Column)("enum",{name:"sex",enum:["0","1"],default:function(){return"'0'"}}),o("design:type",String)],l.prototype,"sex",void 0),n([(0,i.Column)("varchar",{name:"photourl",length:255}),o("design:type",String)],l.prototype,"photourl",void 0),n([(0,i.Column)("datetime",{name:"insertdate",default:function(){return"'CURRENT_TIMESTAMP(6)'"}}),o("design:type",Date)],l.prototype,"insertdate",void 0),n([(0,i.Column)("varchar",{name:"city",length:100}),o("design:type",String)],l.prototype,"city",void 0),n([(0,i.Column)("int",{name:"countryid",nullable:!0}),o("design:type",Number)],l.prototype,"countryid",void 0),n([(0,i.Column)("int",{name:"provinceid",nullable:!0}),o("design:type",Number)],l.prototype,"provinceid",void 0),n([(0,i.Column)("int",{name:"cityid",nullable:!0}),o("design:type",Number)],l.prototype,"cityid",void 0),n([(0,i.OneToMany)((function(){return s.TbCost}),(function(e){return e.user})),o("design:type",Array)],l.prototype,"tbCosts",void 0),n([(0,i.OneToMany)((function(){return u.TbCurrentprice}),(function(e){return e.user})),o("design:type",Array)],l.prototype,"tbCurrentprices",void 0),n([(0,i.ManyToOne)((function(){return c.TbCityinfo}),(function(e){return e.tbUsers}),{onDelete:"NO ACTION",onUpdate:"NO ACTION"}),(0,i.JoinColumn)([{name:"cityid",referencedColumnName:"id"}]),o("design:type",c.TbCityinfo)],l.prototype,"city2",void 0),n([(0,i.ManyToOne)((function(){return c.TbCityinfo}),(function(e){return e.tbUsers2}),{onDelete:"NO ACTION",onUpdate:"NO ACTION"}),(0,i.JoinColumn)([{name:"countryid",referencedColumnName:"id"}]),o("design:type",c.TbCityinfo)],l.prototype,"country",void 0),n([(0,i.ManyToOne)((function(){return c.TbCityinfo}),(function(e){return e.tbUsers3}),{onDelete:"NO ACTION",onUpdate:"NO ACTION"}),(0,i.JoinColumn)([{name:"provinceid",referencedColumnName:"id"}]),o("design:type",c.TbCityinfo)],l.prototype,"province",void 0),n([(0,i.OneToMany)((function(){return a.TbUserRole}),(function(e){return e.user})),o("design:type",Array)],l.prototype,"tbUserRoles",void 0),r=n([(0,i.Index)("fk_user_city",["cityid"],{}),(0,i.Index)("fk_user_country",["countryid"],{}),(0,i.Index)("fk_user_province",["provinceid"],{}),(0,i.Entity)("tb_user",{schema:"mycost"})],l);function l(){}t.TbUser=r},655:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TbUserRole=void 0,r(250)),s=r(737),u=r(754);n([(0,i.PrimaryGeneratedColumn)({type:"int",name:"id"}),o("design:type",Number)],c.prototype,"id",void 0),n([(0,i.Column)("int",{name:"userid",nullable:!0}),o("design:type",Number)],c.prototype,"userid",void 0),n([(0,i.Column)("int",{name:"roleid",nullable:!0}),o("design:type",Number)],c.prototype,"roleid",void 0),n([(0,i.ManyToOne)((function(){return s.TbRole}),(function(e){return e.tbUserRoles}),{onDelete:"NO ACTION",onUpdate:"NO ACTION"}),(0,i.JoinColumn)([{name:"roleid",referencedColumnName:"id"}]),o("design:type",s.TbRole)],c.prototype,"role",void 0),n([(0,i.ManyToOne)((function(){return u.TbUser}),(function(e){return e.tbUserRoles}),{onDelete:"RESTRICT",onUpdate:"RESTRICT"}),(0,i.JoinColumn)([{name:"userid",referencedColumnName:"id"}]),o("design:type",u.TbUser)],c.prototype,"user",void 0),r=n([(0,i.Index)("fk_user_role_roleid",["roleid"],{}),(0,i.Index)("fk_user_role_userid",["userid"],{}),(0,i.Entity)("tb_user_role",{schema:"mycost"})],c);function c(){}t.TbUserRole=r},607:function(e,t,r){"use strict";var n=r(283),o=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),r(860)),u=r(986),c=(t=r(527),r(263)),a=r(550),l=r(811);t.AppDataSource.initialize().then((function(){return o(void 0,void 0,void 0,(function(){var e;return i(this,(function(t){return(e=s()).use(u.json()),e.use("/img",s.static("img")),l(e),c.Routes.forEach((function(t){e[t.method](t.route,a,(function(e,r,n){(e=(new t.controller)[t.action](e,r,n))instanceof Promise?e.then((function(e){return null!=e?r.send(e):void 0})):null!=e&&r.json(e)}))})),e.listen(9999),[2]}))}))})).catch((function(e){return n.log(e)}))},263:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routes=void 0;var n=r(356),o=r(592),i=r(68),s=r(938),u=r(225);r=r(758);t.Routes=[{method:"post",route:"/users/login",controller:i.UserController,action:"login"},{method:"post",route:"/users/register",controller:i.UserController,action:"register"},{method:"delete",route:"/users/:id",controller:i.UserController,action:"remove"},{method:"post",route:"/users/getinfo",controller:i.UserController,action:"getinfo"},{method:"post",route:"/users/logout",controller:i.UserController,action:"logout"},{method:"get",route:"/costs",controller:n.CostController,action:"all"},{method:"post",route:"/costs/insertCost",controller:n.CostController,action:"insertCost"},{method:"delete",route:"/costs/remove/:id",controller:n.CostController,action:"remove"},{method:"get",route:"/costs/getsum",controller:n.CostController,action:"getSum"},{method:"get",route:"/costs/getSumByMonth",controller:n.CostController,action:"getSumByMonth"},{method:"post",route:"/upload",controller:o.UploadController,action:"upload"},{method:"post",route:"/curentprice/insertCurrentPrice",controller:s.CurrentPriceController,action:"insertCurrentPrice"},{method:"get",route:"/curentprice/getTopOneCurrentPrice",controller:s.CurrentPriceController,action:"getTopOneCurrentPrice"},{method:"post",route:"/path/queryAll",controller:u.PathController,action:"queryAll"},{method:"put",route:"/path/addPath",controller:u.PathController,action:"add"},{method:"delete",route:"/path/removePath",controller:u.PathController,action:"delete"},{method:"get",route:"/role/getRole",controller:r.RoleController,action:"getRole"}]},809:(e,t,r)=>{"use strict";var n=r(283);Object.defineProperty(t,"__esModule",{value:!0}),t.convertJsonArrToArr=void 0,t.convertJsonArrToArr=function(e){var t=[];return n.log(e),n.log("test"),e.map((function(e){for(var r in e)t.push(e[r])})),t}},841:(e,t,r)=>{var n=r(283);(r=r(773).createClient({host:"localhost",port:6379})).on("error",(function(e){return n.log("Redis Client Error",e)})),e.exports=r},811:(e,t,r)=>{function n(e,t){t.setHeader("Content-Type","application/json"),t.send(a)}var o=r(423),i=r(860),s=r(948),u=r(777),c=r(231),a=u(r={definition:{openapi:"3.0.0",info:{title:"api",version:"1.0.0",description:"财务管理后台共用接口api"}},apis:[o.join("/","../controller/*.ts")]});e.exports=function(e){(e=e||i()).get("/swagger.json",n);var t=c.readFileSync("./dist/swagger.json");t=JSON.parse(t);e.use("/swagger",s.serve,s.setup(t))}},550:function(e,t,r){var n=r(283),o=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,u)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3]))i.label=s[1];else if(6===s[0]&&i.label<o[1])i.label=o[1],o=s;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(s)}}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this,u=r(344),c=r(841);e.exports=function(e,t,r){return o(s,void 0,void 0,(function(){var o,s,a;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,7,9]),[4,c.connect()];case 1:return i.sent(),[4,c.hVals("blacklist")];case 2:if(null==(o=i.sent())&&(o=[]),s=e.headers.authorization.split(" ").pop(),-1!=e.url.indexOf("/logout"))return[3,3];if(-1!=o.indexOf(s))throw"token error";return e.id=u.verify(s,"token").id,[3,5];case 3:return-1!=o.indexOf(s)?[3,5]:[4,c.hSet("blacklist",o.length,s,{EX:10,NX:!0})];case 4:i.sent(),i.label=5;case 5:return r(),[3,9];case 6:return a=i.sent(),n.log(a),-1==e.url.indexOf("/register")&&-1==e.url.indexOf("/login")||null!=e.body.id&&0!=e.body.id?t.status(401).send("token error"):r(),[3,9];case 7:return[4,c.disconnect()];case 8:return i.sent(),[7];case 9:return[2]}}))}))}},84:e=>{"use strict";e.exports=require("assert")},432:e=>{"use strict";e.exports=require("bcryptjs")},986:e=>{"use strict";e.exports=require("body-parser")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},231:e=>{"use strict";e.exports=require("fs")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},738:e=>{"use strict";e.exports=require("multer")},423:e=>{"use strict";e.exports=require("path")},773:e=>{"use strict";e.exports=require("redis")},236:e=>{"use strict";e.exports=require("reflect-metadata")},777:e=>{"use strict";e.exports=require("swagger-jsdoc")},948:e=>{"use strict";e.exports=require("swagger-ui-express")},250:e=>{"use strict";e.exports=require("typeorm")},464:e=>{"use strict";e.exports=require("util")}},t={};function r(n){var o=t[n];return void 0!==o||(o=t[n]={exports:{}},e[n].call(o.exports,o,o.exports,r)),o.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(607)})();